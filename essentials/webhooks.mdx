---
title: "Webhooks"
description: "Set up webhooks for real-time payment notifications"
---

# Webhooks

Webhooks deliver real-time notifications about events in your Orafi account.

## Registering Webhooks

Set up webhook endpoints:

```javascript
await fetch('/webhook/register', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': process.env.ORAFI_API_KEY
  },
  body: JSON.stringify({
    url: 'https://yourapp.com/webhooks/orafi',
    secret: 'your_webhook_secret',
    events: ['payment.confirmed', 'payment.failed']
  })
});
```

## Webhook Events

- `payment.initialized`: Payment created
- `payment.confirmed`: Payment confirmed on blockchain
- `payment.failed`: Payment failed or expired
- `payout.completed`: Payout completed
- `refund.processed`: Refund processed

## Payload Structure

```json
{
  "event": "payment.confirmed",
  "data": {
    "id": "pay_abc123",
    "amount": 10000,
    "status": "CONFIRMED",
    "txRef": "tx_123456789",
    "customerId": "cus_xyz789",
    "transactionId": "txn_def456"
  },
  "timestamp": 1640995260
}
```

## Signature Verification

```javascript
const crypto = require('crypto');

function verifyWebhook(payload, signature, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(payload)
    .digest('hex');
  
  return crypto.timingSafeEqual(
    Buffer.from(signature, 'hex'),
    Buffer.from(expectedSignature, 'hex')
  );
}
```

## Managing Webhooks

Get webhook details:

```javascript
const webhook = await fetch('/webhook', {
  headers: {
    'x-api-key': process.env.ORAFI_API_KEY
  }
});
```

Subscribe to events:

```javascript
await fetch('/webhook/subscribe', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': process.env.ORAFI_API_KEY
  },
  body: JSON.stringify({
    events: ['payout.completed']
  })
});
```

Get delivery history:

```javascript
const deliveries = await fetch('/webhook/deliveries', {
  headers: {
    'x-api-key': process.env.ORAFI_API_KEY
  }
});
```

## Webhook Schema

```json
{
  "id": "wh_abc123",
  "url": "https://yourapp.com/webhooks/orafi",
  "secret": "whsec_...",
  "events": ["payment.confirmed", "payment.failed"]
}
```

## Best Practices

1. **Signature verification**: Always verify webhook signatures
2. **Idempotency**: Handle duplicate events gracefully
3. **Timely processing**: Respond within 10 seconds
4. **Logging**: Log all webhook attempts
5. **Security**: Use HTTPS endpoints only